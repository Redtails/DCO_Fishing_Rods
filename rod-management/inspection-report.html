<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Inspection Report Form</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: sans-serif; background:#f2f2f2; margin:0; padding:0;
      display:flex; justify-content:center; align-items:center; min-height:100vh; }
    form { background:#fff; padding:30px; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.1);
      width:100%; max-width:500px; }
    h2 { text-align:center; margin-bottom:20px; }
    .field { margin-bottom:16px; }
    label { display:block; margin-bottom:6px; font-weight:600; }
    input, select, textarea, button {
      width:100%; padding:10px; font-size:16px; border:1px solid #ccc; border-radius:4px;
      box-sizing:border-box; transition:border-color .2s; }
    input:focus, select:focus, textarea:focus { border-color:#0078d7; outline:none; }
    .submit-btn { background:#0078d7; color:#fff; border:none; cursor:pointer; padding:12px; }
    .submit-btn:hover { background:#005fa3; }
    .msg { margin-top:12px; padding:10px; border-radius:4px; display:none; text-align:center; }
    .success { background:#e0f7e9; color:#2e7d32; }
    .error   { background:#fdecea; color:#b00020; }
  </style>
</head>
<body>

  <form id="inspectionForm" novalidate>
    <h2>Inspection Report</h2>

    <div class="field">
      <label for="inspectorSelect">Inspector</label>
      <select id="inspectorSelect" required>
        <option value="">-- Select Inspector --</option>
      </select>
    </div>

    <div class="field">
      <label for="shift">Shift</label>
      <select id="shift" required>
        <option value="" disabled selected>Select shift</option>
        <option value="A">A</option>
        <option value="B">B</option>
        <option value="C">C</option>
      </select>
    </div>

    <div class="field">
      <label for="itemInspected">Batch ID</label>
      <input type="text" id="itemInspected" required />
    </div>

    <div class="field">
      <label for="findings">Findings</label>
      <textarea id="findings" rows="4" required></textarea>
    </div>

    <button type="submit" class="submit-btn">Submit Report</button>

    <div class="msg success" id="successMessage">✅ Report submitted successfully!</div>
    <div class="msg error" id="errorMessage">⚠️ There was an error submitting the report.</div>
  </form>

  <script>
    const form       = document.getElementById('inspectionForm');
    const successMsg = document.getElementById('successMessage');
    const errorMsg   = document.getElementById('errorMessage');
    const inspectorSelect = document.getElementById('inspectorSelect');

    // Populate inspectors
    async function loadInspectors() {
      try {
        const res = await fetch('/api/users');
        if (!res.ok) throw new Error('Failed to fetch inspectors');
        const users = await res.json();
        users.forEach(u => {
          const opt = document.createElement('option');
          opt.value = u.user_id;
          opt.textContent = u.username;
          // Optionally filter by role if you track roles
          inspectorSelect.appendChild(opt);
        });
      } catch (err) {
        console.error(err);
      }
    }

    form.addEventListener('submit', async e => {
      e.preventDefault();
      successMsg.style.display = 'none';
      errorMsg.style.display   = 'none';

      const payload = {
        inspector_id: parseInt(inspectorSelect.value, 10),
        shift:        document.getElementById('shift').value,
        batch_id:     document.getElementById('itemInspected').value.trim(),
        findings:     document.getElementById('findings').value.trim()
      };

      if (!payload.inspector_id || !payload.shift || !payload.batch_id || !payload.findings) {
        errorMsg.textContent = '⚠️ Please fill out all fields.';
        return errorMsg.style.display = 'block';
      }

      try {
        const res = await fetch('/api/inspection-report', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        if (!res.ok) throw new Error(res.statusText);
        form.reset();
        successMsg.style.display = 'block';
        setTimeout(()=> successMsg.style.display='none', 3000);
      } catch (err) {
        console.error('Submit error:', err);
        errorMsg.textContent = '⚠️ Server error — could not save report.';
        errorMsg.style.display = 'block';
      }
    });

    document.addEventListener('DOMContentLoaded', loadInspectors);
  </script>
</body>
</html>


