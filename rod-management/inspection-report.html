<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Inspection Report Form</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; background:#f2f2f2; margin:0; padding:0;
      display:flex; justify-content:center; align-items:center; min-height:100vh; }
    form { background:#fff; padding:30px; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.1);
      width:100%; max-width:500px; }
    h2 { text-align:center; margin-bottom:20px; }
    .field { margin-bottom:16px; }
    label { display:block; margin-bottom:6px; font-weight:600; }
    input, select, textarea, button {
      width:100%; padding:10px; font-size:16px; border:1px solid #ccc; border-radius:4px;
      box-sizing:border-box; transition:border-color .2s; }
    input:focus, select:focus, textarea:focus { border-color:#0078d7; outline:none; }
    .submit-btn { background:#0078d7; color:#fff; border:none; cursor:pointer; }
    .submit-btn:hover { background:#005fa3; }
    .msg { margin-top:12px; padding:10px; border-radius:4px; display:none; text-align:center; }
    .success { background:#e0f7e9; color:#2e7d32; }
    .error   { background:#fdecea; color:#b00020; }
  </style>
</head>
<body>

  <form id="inspectionForm" novalidate>
    <h2>Inspection Report</h2>

    <div class="field">
      <label for="inspectorId">Inspector ID</label>
      <input type="number" id="inspectorId" name="inspectorId" required>
    </div>

    <div class="field">
      <label for="shift">Shift</label>
      <select id="shift" name="shift" required>
        <option value="" disabled selected>Select shift</option>
        <option value="A">A</option>
        <option value="B">B</option>
        <option value="C">C</option>
      </select>
    </div>

    <div class="field">
      <label for="inspectionDate">Inspection Date</label>
      <input type="date" id="inspectionDate" name="inspectionDate" required>
    </div>

    <div class="field">
      <label for="itemInspected">Item Inspected (Batch ID)</label>
      <input type="text" id="itemInspected" name="itemInspected" required>
    </div>

    <div class="field">
      <label for="findings">Findings</label>
      <textarea id="findings" name="findings" rows="4" required></textarea>
    </div>

    <button type="submit" class="submit-btn">Submit Report</button>

    <div class="msg success" id="successMessage">
      ✅ Report submitted successfully!
    </div>
    <div class="msg error" id="errorMessage">
      ⚠️ There was an error submitting the report.
    </div>
  </form>

  <script>
    const form     = document.getElementById('inspectionForm');
    const okMsg    = document.getElementById('successMessage');
    const errMsg   = document.getElementById('errorMessage');

    form.addEventListener('submit', async e => {
      e.preventDefault();
      okMsg.style.display = 'none';
      errMsg.style.display = 'none';

      const payload = {
        inspector_id:  Number(document.getElementById('inspectorId').value),
        shift:         document.getElementById('shift').value,
        batch_id:      document.getElementById('itemInspected').value.trim(),
        findings:      document.getElementById('findings').value.trim()
      };

      // Basic validation
      if (!payload.inspector_id || !payload.shift || !payload.batch_id || !payload.findings) {
        errMsg.textContent = '⚠️ Please fill out all fields.';
        return errMsg.style.display = 'block';
      }

      try {
        const res = await fetch('/api/inspection-report', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        if (!res.ok) throw new Error(`Status ${res.status}`);

        form.reset();
        okMsg.style.display = 'block';
        setTimeout(() => okMsg.style.display = 'none', 3000);
      } catch (err) {
        console.error('Submit error:', err);
        errMsg.textContent = '⚠️ Server error — could not save report.';
        errMsg.style.display = 'block';
      }
    });
  </script>
</body>
</html>

